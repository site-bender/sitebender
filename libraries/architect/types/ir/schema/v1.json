{
	"$schema": "https://json-schema.org/draft/2020-12/schema",
	"$id": "https://sitebender.dev/schemas/architect/ir/v1.json",
	"title": "@sitebender/architect IR Schema v1",
	"description": "JSON Schema for @sitebender/architect Intermediate Representation (IR) nodes",
	"type": "object",
	"definitions": {
		"version": {
			"type": "string",
			"const": "0.1.0"
		},
		"nodeId": {
			"type": "string",
			"pattern": "^[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}$"
		},
		"dataType": {
			"type": "string",
			"enum": [
				"String",
				"Integer",
				"Float",
				"Boolean",
				"PlainDate",
				"PlainDateTime",
				"ZonedDateTime"
			]
		},
		"baseMeta": {
			"type": "object",
			"properties": {
				"source": { "type": "string" },
				"debug": { "type": "object" }
			},
			"additionalProperties": false
		},
		"baseNode": {
			"type": "object",
			"properties": {
				"v": { "$ref": "#/definitions/version" },
				"id": { "$ref": "#/definitions/nodeId" },
				"kind": { "type": "string" },
				"meta": { "$ref": "#/definitions/baseMeta" }
			},
			"required": ["v", "id", "kind"],
			"additionalProperties": true
		},
		"elementNode": {
			"allOf": [
				{ "$ref": "#/definitions/baseNode" },
				{
					"type": "object",
					"properties": {
						"kind": { "const": "element" },
						"tag": { "type": "string" },
						"attrs": {
							"type": "object",
							"patternProperties": {
								"^[a-zA-Z][a-zA-Z0-9-]*$": {
									"oneOf": [
										{ "type": "string" },
										{ "type": "number" },
										{ "type": "boolean" }
									]
								}
							},
							"additionalProperties": false
						},
						"children": {
							"type": "array",
							"items": { "$ref": "#/definitions/node" }
						}
					},
					"required": ["kind", "tag", "attrs", "children"]
				}
			]
		},
		"injectorNode": {
			"allOf": [
				{ "$ref": "#/definitions/baseNode" },
				{
					"type": "object",
					"properties": {
						"kind": { "const": "injector" },
						"injector": { "type": "string" },
						"datatype": { "$ref": "#/definitions/dataType" },
						"args": { "type": "object" }
					},
					"required": ["kind", "injector", "datatype", "args"]
				}
			]
		},
		"operatorNode": {
			"allOf": [
				{ "$ref": "#/definitions/baseNode" },
				{
					"type": "object",
					"properties": {
						"kind": { "const": "operator" },
						"op": { "type": "string" },
						"datatype": { "$ref": "#/definitions/dataType" },
						"args": {
							"type": "array",
							"items": { "$ref": "#/definitions/node" }
						}
					},
					"required": ["kind", "op", "datatype", "args"]
				}
			]
		},
		"comparatorNode": {
			"allOf": [
				{ "$ref": "#/definitions/baseNode" },
				{
					"type": "object",
					"properties": {
						"kind": { "const": "comparator" },
						"cmp": { "type": "string" },
						"args": {
							"type": "array",
							"items": { "$ref": "#/definitions/node" }
						}
					},
					"required": ["kind", "cmp", "args"]
				}
			]
		},
		"conditionalNode": {
			"allOf": [
				{ "$ref": "#/definitions/baseNode" },
				{
					"type": "object",
					"properties": {
						"kind": { "const": "conditional" },
						"condition": { "$ref": "#/definitions/comparatorNode" },
						"ifTrue": {
							"type": "array",
							"items": { "$ref": "#/definitions/node" }
						},
						"ifFalse": {
							"type": "array",
							"items": { "$ref": "#/definitions/node" }
						}
					},
					"required": ["kind", "condition", "ifTrue", "ifFalse"]
				}
			]
		},
		"validatorNode": {
			"allOf": [
				{ "$ref": "#/definitions/baseNode" },
				{
					"type": "object",
					"properties": {
						"kind": { "const": "validator" },
						"rule": { "$ref": "#/definitions/comparatorNode" },
						"scope": {
							"oneOf": [
								{ "$ref": "#/definitions/nodeId" },
								{ "const": "self" }
							]
						},
						"mode": {
							"type": "string",
							"enum": ["accumulate", "short-circuit"]
						}
					},
					"required": ["kind", "rule", "scope"]
				}
			]
		},
		"actionNode": {
			"allOf": [
				{ "$ref": "#/definitions/baseNode" },
				{
					"type": "object",
					"properties": {
						"kind": { "const": "action" },
						"action": { "type": "string" },
						"args": {
							"type": "array",
							"items": { "$ref": "#/definitions/node" }
						}
					},
					"required": ["kind", "action", "args"]
				}
			]
		},
		"eventBindingNode": {
			"allOf": [
				{ "$ref": "#/definitions/baseNode" },
				{
					"type": "object",
					"properties": {
						"kind": { "const": "on" },
						"event": { "type": "string" },
						"handler": { "$ref": "#/definitions/actionNode" }
					},
					"required": ["kind", "event", "handler"]
				}
			]
		},
		"node": {
			"oneOf": [
				{ "$ref": "#/definitions/elementNode" },
				{ "$ref": "#/definitions/injectorNode" },
				{ "$ref": "#/definitions/operatorNode" },
				{ "$ref": "#/definitions/comparatorNode" },
				{ "$ref": "#/definitions/conditionalNode" },
				{ "$ref": "#/definitions/validatorNode" },
				{ "$ref": "#/definitions/actionNode" },
				{ "$ref": "#/definitions/eventBindingNode" }
			]
		},
		"irDocument": {
			"$ref": "#/definitions/elementNode"
		}
	},
	"$ref": "#/definitions/irDocument"
}
