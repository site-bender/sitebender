{
	# Global options
	auto_https off
	admin off
}

# Caddy HTTP/2 + WebSocket Fallback Server
# Provides fallback for browsers without HTTP/3 support

:8443 {
	# TLS with mkcert certificates
	tls /certs/app.localhost.pem /certs/app.localhost-key.pem

	# Health check endpoint
	handle /health {
		respond "OK" 200
	}

	# WebSocket endpoint for hot reload
	handle /ws {
		reverse_proxy localhost:9001 {
			# WebSocket upgrade headers
			header_up Upgrade {http.request.header.Upgrade}
			header_up Connection {http.request.header.Connection}
		}
	}

	# Static file serving
	handle /* {
		root * /app/dist
		try_files {path} {path}/index.html /index.html
		file_server
	}

	# Security headers
	header {
		# Prevent clickjacking
		X-Frame-Options "SAMEORIGIN"
		# Prevent MIME sniffing
		X-Content-Type-Options "nosniff"
		# Enable XSS protection
		X-XSS-Protection "1; mode=block"
		# Referrer policy
		Referrer-Policy "strict-origin-when-cross-origin"
	}

	# Logging
	log {
		output stdout
		format console
		level INFO
	}
}
