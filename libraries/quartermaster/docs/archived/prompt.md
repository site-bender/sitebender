# Prompt for Tomorrow: Folder Hierarchy Fix

## Context: What Happened

We lost our previous session and the `folder-hierarchy.md` document has MAJOR ERRORS that need to be fixed. Guy is (justifiably) pissed off about having to redo this work.

## What We Figured Out Today (2025-10-02)

### The Correct Application Structure

```
my-app/
├── .sitebender/           # Autogenerated - NEVER edit
│   ├── certs/            # SSL certificates
│   ├── contracts/        # Warden contracts
│   ├── tests/            # Auditor/Quarrier/Arborist tests & proofs
│   ├── blueprints/       # Quartermaster config
│   └── scripts/          # Build scripts
│
├── modules/               # ALL application modules (was wrongly called "pages")
│   ├── index.tsx         # <Sitebender> root config - the "module of modules"
│   ├── HomePage/
│   │   └── index.tsx    # Has <Route>, gets promoted to full page
│   ├── ContactPage/
│   │   ├── index.tsx    # Has <Route>, gets promoted to full page
│   │   └── ContactForm/
│   │       └── index.tsx # Nested - only ContactPage uses it
│   └── SharedComponent/
│       └── index.tsx    # At LCA - used by multiple modules
│
├── auth/                  # Auth components (Sentinel wrapper + config)
│   ├── Locked/
│   │   └── index.tsx    # <Sentinel> wrapper with app config baked in
│   ├── Key/
│   │   └── index.tsx    # Key component
│   ├── Keys/
│   │   └── index.ts     # KEYS constant (named export)
│   └── config/
│       └── WebAuthn/
│           └── index.tsx
│
├── ledger/                # Custodian state machines (imported into modules/index.tsx)
│   ├── CheckoutWizard/
│   │   └── index.tsx
│   └── UserPreferences/
│       └── index.tsx
│
├── events/                # Operator pub/sub config (imported into modules/index.tsx)
│   ├── Analytics/
│   │   └── index.tsx
│   └── Notifications/
│       └── index.tsx
│
├── connections/           # Agent P2P/CRDT/DID config (imported into modules/index.tsx)
│   └── RealtimeCollab/
│       └── index.tsx
│
├── assets/                # Static files
│   ├── images/
│   └── fonts/
│
└── dist/                  # Build output
```

### ABSOLUTE RULES (NO EXCEPTIONS - Guy has repeated these MANY times)

1. **ALL FILES ARE NAMED `index.ts` OR `index.tsx`** - PERIOD. NO EXCEPTIONS.
2. **NAMES GO ON FOLDERS** - ALWAYS
3. **ONE FUNCTION/COMPONENT PER FILE** - folder name = function name
4. **Components/Modules = PascalCase folders** (HomePage, ContactForm)
5. **Config/utilities = camelCase folders** (if needed, but usually PascalCase)
6. **DEFAULT EXPORTS ONLY** for functions/components
7. **NAMED EXPORTS** only for types and constants (like KEYS)

### Key Concepts

#### Modules Follow Lowest Common Ancestor (LCA) Rule

- **If used by ONE module**: Nest it inside that module
- **If used by MULTIPLE modules**: Move to the LCA folder (lowest common ancestor)
- **Example**: ContactForm used by ContactPage AND AboutPage → moves to `modules/ContactForm/`

#### Routes and Page Promotion

- Modules with `<Route>` get promoted to full HTML pages (html/head/body/main wrapper)
- Modules without routes render as components (section/article/aside/card based on context)
- Routes are **relative to parent path** in nested modules

#### Auth Components Pattern

- `auth/` folder contains **wrapper components** around Sentinel
- `auth/Locked/index.tsx` wraps `<Sentinel>` with app's auth config baked in
- Modules import from `auth/Locked/` and use it directly
- No need to pass config everywhere - it's baked into the component

### Import/Export Pattern (Guy's Rules)

**WRONG**:

```tsx
// auth/index.tsx - NO barrel files!
export { default as Locked } from "./Locked/index.tsx"
export { KEYS } from "./Keys/index.ts"
```

**RIGHT**:

```tsx
// modules/AdminDashboard/index.tsx
import Locked from "../../auth/Locked/index.tsx" // Default import
import Key from "../../auth/Key/index.tsx" // Default import
import { KEYS } from "../../auth/Keys/index.ts" // Named - it's a const
import And from "@sitebender/artificer/logical/And/index.tsx"

export default function AdminDashboard() {
	return (
		<Locked>
			<And>
				<Key>{KEYS.admin}</Key>
				<Key>{KEYS.verified}</Key>
			</And>
			<Route path="/admin" page={<AdminPanel />} />
		</Locked>
	)
}
```

### Files to Fix

1. **`libraries/quartermaster/docs/folder-hierarchy.md`** - MAJOR REWRITE NEEDED
   - Replace "pages/" with "modules/"
   - Fix the "Complete Structure" section
   - Remove all kebab-case filenames (checkout-wizard.tsx → ledger/CheckoutWizard/index.tsx)
   - Fix all import/export examples
   - Add auth/ folder explanation
   - Emphasize LCA rule
   - Emphasize "ALL FILES ARE index.ts/tsx"

2. **`libraries/steward/docs/locks.md`** - Update auth import examples
   - Show correct imports from auth/Locked/, auth/Key/
   - Remove any barrel file examples

3. **`libraries/steward/docs/locks.yaml`** - Same fixes as locks.md

## Your Task Tomorrow

1. **Read this prompt first**
2. **Read the current `folder-hierarchy.md`** to see what's wrong
3. **Fix the entire document** with the correct structure above
4. **Verify import/export patterns** throughout - NO BARREL FILES
5. **Update lock documentation** if needed for auth imports
6. **Show Guy the changes** before committing

## What Guy is Frustrated About

- Having to repeat "ALL FILES ARE index.tsx" over and over
- AIs ignoring the rule and creating files like `checkout-wizard.tsx`
- Using kebab-case instead of PascalCase for component folders
- Creating barrel files when they're explicitly forbidden
- Losing work from the previous session and having to redo it

## DO NOT

- Create any file that isn't named `index.ts` or `index.tsx`
- Use kebab-case for component folders (it's PascalCase!)
- Create barrel files (`auth/index.tsx` that re-exports everything)
- Forget the LCA rule (shared stuff goes at lowest common ancestor)
- Make up SQL examples (it's a triple store! Use Turtle/RDF/OWL2!)

## Remember

Guy has excellent reasons for these rules:

- **index.ts only**: Clean imports, no naming confusion
- **Names on folders**: Easy to move/delete entire modules
- **No barrels**: Clear dependencies, better tree-shaking
- **LCA rule**: Modules are decoupled and portable
- **PascalCase components**: Standard convention, clear intent

Be precise. Follow the rules. Don't make Guy repeat himself again.

---

**Status**: Ready to fix folder-hierarchy.md tomorrow
**Priority**: HIGH - Guy is waiting on this
**Estimated time**: 1-2 hours to rewrite the document correctly
