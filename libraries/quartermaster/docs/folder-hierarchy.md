# Generated Application Folder Hierarchy

> **Module-based organization with Lowest Common Ancestor pattern**

This document describes the folder structure that Quartermaster generates for Studio applications. Every design decision follows the principle: **move a folder, move everything it needs**.

## Table of Contents

- [Design Philosophy](#design-philosophy)
- [Complete Structure](#complete-structure)
- [Folder Descriptions](#folder-descriptions)
- [Design Decisions](#design-decisions)
- [What Goes Where](#what-goes-where)
- [Related Documentation](#related-documentation)

---

## Design Philosophy

### Absolute Rules (NO EXCEPTIONS)

1. **ALL FILES ARE NAMED `index.ts` OR `index.tsx`** - PERIOD
2. **NAMES GO ON FOLDERS** - ALWAYS
3. **ONE FUNCTION/COMPONENT PER FILE** - Folder name matches function/component name
4. **DEFAULT EXPORTS ONLY** - Functions and components export default
5. **NAMED EXPORTS** - Only for types and constants (like KEYS)
6. **PascalCase for components/modules** - HomePage, ContactForm, CheckoutWizard
7. **Lowest Common Ancestor (LCA)** - Shared code lives at the branching point below which all consumers reside

### Principles

1. **Modules all the way down** - Everything is a module (Pagewright component)
2. **Routes promote modules** - Modules with `<Route>` become full HTML pages
3. **No routes = component** - Rendered as section/article/aside based on context
4. **Decoupled and portable** - Move a folder, everything it needs moves with it
5. **LCA rule eliminates duplication** - Shared modules live at lowest common ancestor

### Anti-Patterns We Avoid

- ❌ Files not named `index.ts` or `index.tsx` (like `checkout-wizard.tsx`)
- ❌ kebab-case for components (use PascalCase: `CheckoutWizard/`, not `checkout-wizard/`)
- ❌ Barrel files (no `auth/index.tsx` that re-exports everything)
- ❌ Generic folders (`utils/`, `helpers/`, `common/`)
- ❌ `src/` wrapper folder when not needed

---

## Complete Structure

```
my-app/
├── .sitebender/              # Autogenerated (NEVER edit)
│   ├── certs/               # SSL certificates for HTTPS dev server
│   │   ├── localhost-key.pem
│   │   └── localhost.pem
│   ├── contracts/           # Warden cryptographic contracts
│   │   ├── privacy.json
│   │   └── imports.json
│   ├── tests/               # Auditor/Quarrier/Arborist tests & proofs
│   │   ├── properties/
│   │   └── proofs/
│   ├── blueprints/          # Quartermaster config history (RDF triples)
│   │   ├── initial.ttl
│   │   └── history/
│   └── scripts/             # Build scripts, enforcement
│       ├── build.ts
│       └── enforce.ts
│
├── modules/                  # ALL application modules
│   ├── index.tsx            # <Sitebender> - root "module of modules"
│   ├── HomePage/
│   │   └── index.tsx       # Route "/" - promoted to full page
│   ├── AboutPage/
│   │   └── index.tsx       # Route "/about" - promoted to full page
│   ├── ContactPage/
│   │   ├── index.tsx       # Route "/contact" - promoted to full page
│   │   └── ContactForm/
│   │       └── index.tsx   # Nested - only ContactPage uses it
│   ├── BlogPage/
│   │   ├── index.tsx       # Route "/blog" - promoted to full page
│   │   ├── PostList/
│   │   │   └── index.tsx
│   │   └── PostDetail/
│   │       └── index.tsx
│   └── SharedComponent/     # At LCA - used by multiple modules
│       └── index.tsx
│
├── data/                     # Concept definitions (schema/ontology)
│   ├── Person/
│   │   └── index.tsx        # Person concept with properties/shapes
│   ├── Organization/
│   │   └── index.tsx
│   └── concepts/            # Primitive concepts (reusable types)
│       ├── EmailAddress/
│       │   └── index.tsx
│       └── PhoneNumber/
│           └── index.tsx
│
├── auth/                     # Auth components (Sentinel wrappers)
│   ├── Locked/
│   │   └── index.tsx       # Wraps <Sentinel> with app config
│   ├── Key/
│   │   └── index.tsx
│   ├── Keys/
│   │   └── index.ts        # KEYS constant (named export)
│   └── config/
│       └── WebAuthn/
│           └── index.tsx
│
├── ledger/                   # Custodian state machines
│   ├── CheckoutWizard/
│   │   └── index.tsx
│   └── UserPreferences/
│       └── index.tsx
│
├── events/                   # Operator pub/sub configurations
│   ├── Analytics/
│   │   └── index.tsx
│   └── Notifications/
│       └── index.tsx
│
├── connections/              # Agent P2P/CRDT/DID configurations
│   └── RealtimeCollab/
│       └── index.tsx
│
├── assets/                   # Static resources
│   ├── images/
│   │   ├── logo.svg
│   │   └── hero.jpg
│   ├── fonts/
│   │   └── inter-var.woff2
│   └── styles/              # Global styles (if not inline)
│       └── base.css
│
├── dist/                     # Build output (gitignored)
│   ├── index.html
│   └── assets/
│
├── deno.jsonc               # Deno config, tasks, compiler options
├── import_map.json          # Import map for library aliases
└── README.md                # Generated project documentation
```

---

## Folder Descriptions

### `.sitebender/` - Hidden Autogenerated Content

**Purpose**: Everything the user should never need to see or touch.

**Contains**:

- **`certs/`** - SSL certificates for HTTPS development server (via mkcert)
- **`contracts/`** - Warden cryptographic contracts enforcing architecture
- **`tests/`** - Auditor/Quarrier/Arborist autogenerated property tests and proofs
- **`blueprints/`** - Quartermaster configuration history as RDF triples (time-travel)
- **`scripts/`** - Build scripts, tooling, enforcement scripts

**Rationale**: Users work with JSX components, not build infrastructure. Hide the machinery.

**Gitignore**: Most contents gitignored (certs, build artifacts), except contracts and blueprints.

---

### `modules/` - All Application Modules

**Purpose**: The entire application as a tree of composable modules.

**File**: `modules/index.tsx` - The `<Sitebender>` root configuration component

**Structure**:

```tsx
// modules/index.tsx
import checkoutWizard from "../ledger/CheckoutWizard/index.tsx";
import analytics from "../events/Analytics/index.tsx";
import authConfig from "../auth/config/WebAuthn/index.tsx";

export default function Sitebender() {
  return (
    <Sitebender auth={authConfig}>
      <Ledger>{checkoutWizard}</Ledger>
      <Events>{analytics}</Events>

      {/* Application routes - modules get promoted to pages */}
      <Routes>
        <Route path="/" page={<HomePage />} />
        <Route path="/about" page={<AboutPage />} />
        <Route path="/contact" page={<ContactPage />} />
      </Routes>
    </Sitebender>
  );
}
```

**Key Concepts**:

1. **Every folder is a module** (Pagewright component)
2. **Modules with `<Route>` = pages** (get `<html><head><body><main>` wrapper)
3. **Modules without routes = components** (render as section/article/aside based on context)
4. **Nested when used by one module** (ContactPage/ContactForm/)
5. **At LCA when shared** (used by multiple modules → moves up to common ancestor)

**Example - LCA Rule**:

```
# ContactForm only used by ContactPage:
modules/
├── ContactPage/
│   ├── index.tsx
│   └── ContactForm/          # Nested
│       └── index.tsx

# ContactForm used by ContactPage AND AboutPage:
modules/
├── ContactPage/
│   └── index.tsx
├── AboutPage/
│   └── index.tsx
└── ContactForm/               # Moved to LCA (modules/)
    └── index.tsx
```

**Rationale**: "modules" not "pages" because they're multi-purpose. Context determines rendering.

---

### `data/` - Concept Definitions (Schema/Ontology)

**Purpose**: Domain data model as living ontology stored in triple store.

**Contains**:

- **Concept definitions** - Domain entities with properties, shapes, and relationships
- **Primitive concepts** - Reusable datatypes (EmailAddress, PhoneNumber, etc.)
- **SHACL shapes** - Validation rules embedded in concept definitions
- **Compiles to**: RDF triples, SHACL constraints, database schemas

**Example**:

```tsx
// data/Person/index.tsx
export default function Person() {
  return (
    <Concept name="Person">
      <Property name="email">
        <EmailAddress />  {/* References primitive concept */}
      </Property>
      <Property name="age">
        <PositiveInteger />
      </Property>
      <HasOne name="worksFor">
        <Organization />
      </HasOne>
    </Concept>
  );
}

// data/concepts/EmailAddress/index.tsx
export default function EmailAddress() {
  return (
    <Concept name="EmailAddress" type="string">
      <Shape>
        <And>
          <Is.String />
          <Matches pattern="^.+@.+$" />
          <MinLength value={5} />
          <MaxLength value={150} />
        </And>
      </Shape>
    </Concept>
  );
}
```

**Forms Auto-Generate from Concepts**:

```tsx
// Fully automatic - queries triple store for Person concept
<Form concept="Person" type="create" />

// With layout control
<Form concept="Person">
  <Hidden>
    <Feature name="id" />
  </Hidden>
  <Group name="personal">
    <Feature name="email" help="Custom help text" />
    <Feature name="age" />
  </Group>
</Form>
```

**Rationale**: Concepts are the single source of truth. Forms, validation, database constraints, and tests all derive from concept definitions.

---

### `auth/` - Authentication Components

**Purpose**: Wrapper components around Sentinel with app-specific auth configuration baked in.

**Contains**:

- **`Locked/index.tsx`** - Wraps `<Sentinel>` with auth config
- **`Key/index.tsx`** - Key component
- **`Keys/index.ts`** - KEYS constant (named export)
- **`config/`** - Auth provider configurations (WebAuthn, OAuth, etc.)

**Example**:

```tsx
// auth/Locked/index.tsx
import Sentinel from "@sitebender/sentinel/Sentinel/index.tsx";
import webAuthnConfig from "../config/WebAuthn/index.tsx";

export default function Locked({ children }) {
  return <Sentinel config={webAuthnConfig}>{children}</Sentinel>;
}
```

**Usage**:

```tsx
// modules/AdminDashboard/index.tsx
import Locked from "../../auth/Locked/index.tsx";
import Key from "../../auth/Key/index.tsx";
import { KEYS } from "../../auth/Keys/index.ts";

export default function AdminDashboard() {
  return (
    <Locked>
      <Key>{KEYS.admin}</Key>
      <Route path="/admin" page={<AdminPanel />} />
    </Locked>
  );
}
```

**Rationale**: Auth config baked into reusable components. No passing config everywhere. Modules just import and use.

**See Also**: [Lock System Documentation](../../steward/docs/locks.md) for complete details on `<Locked>`, `<Key>`, and authorization patterns.

---

### `ledger/` - State Management

**Purpose**: Custodian state machine configurations.

**Contains**:

- State machine definitions (one per folder)
- Imported into `modules/index.tsx` and used in `<Sitebender>`

**Example**:

```tsx
// ledger/CheckoutWizard/index.tsx
export default {
  id: "checkout",
  initial: "cart",
  states: {
    cart: {
      on: { PROCEED: "shipping" },
    },
    shipping: {
      on: {
        PROCEED: "payment",
        BACK: "cart",
      },
    },
    payment: {
      on: {
        PROCEED: "confirmation",
        BACK: "shipping",
      },
    },
    confirmation: {
      type: "final",
    },
  },
};
```

**Rationale**: "ledger" evokes bookkeeping/accounting (state tracking). More semantic than "state".

---

### `events/` - Pub/Sub Configuration

**Purpose**: Operator event configurations for pub/sub messaging.

**Contains**:

- Event channel definitions (one per folder)
- Imported into `modules/index.tsx`

**Example**:

```tsx
// events/Analytics/index.tsx
export default {
  channel: "analytics",
  scope: "network",
  events: [
    { type: "page-view", schema: "PageViewEvent" },
    { type: "user-action", schema: "UserActionEvent" },
  ],
};
```

**Rationale**: Clear purpose (event messaging) without technical jargon.

---

### `connections/` - Distributed/P2P Configuration

**Purpose**: Agent configurations for CRDTs, P2P, distributed state, DIDs.

**Contains**:

- P2P/distributed configurations (one per folder)
- Imported into `modules/index.tsx`

**Example**:

```tsx
// connections/RealtimeCollab/index.tsx
export default {
  type: "crdt",
  dataStructure: "yjs",
  transport: "webrtc",
  fallback: "websocket",
  peers: "auto-discover",
};
```

**Rationale**: User-friendly term (connecting to devices/users/services) vs technical "distributed"/"P2P".

---

### `assets/` - Static Resources

**Purpose**: Static files like images, fonts, videos, global styles.

**Contains**:

- `images/` - Image files
- `fonts/` - Font files
- `videos/` - Video files (if needed)
- `styles/` - Global CSS (if not using inline styles)
- `icons/` - Icon files
- Any other static resources

**Rationale**: "assets" is clear and widely used. "public" is confusing (pages are public too).

---

### `dist/` - Build Output

**Purpose**: Generated files from the build process.

**Contains**:

- Compiled HTML, CSS, JavaScript
- Optimized assets
- Generated routing configuration
- All production-ready files

**Gitignore**: Entire folder should be in `.gitignore`.

**Rationale**: Standard convention (dist = distribution files).

---

## Design Decisions

### Why ALL Files Named `index.ts` or `index.tsx`?

**Decision**: Every file must be named `index.ts` or `index.tsx`. Names go on folders.

**Rationale**:

- **Clean imports**: `import HomePage from "./modules/HomePage/index.tsx"` (folder name is the identifier)
- **No naming confusion**: Folder name = module name, always
- **Easy to move/delete**: Move folder = move module with all its dependencies
- **No duplicate names**: Can't have `HomePage.tsx` and `HomePage/index.tsx` conflicting

**Example**:

```
WRONG:
modules/
├── home-page.tsx        # ❌ kebab-case filename
└── contact-form.tsx     # ❌ What folder does this belong to?

RIGHT:
modules/
├── HomePage/
│   └── index.tsx       # ✅ Folder name = module name
└── ContactForm/
    └── index.tsx       # ✅ Clear, consistent, moveable
```

---

### Why No `src/` Folder?

**Decision**: No `src/` wrapper folder. Top-level folders are `modules/`, `auth/`, `ledger/`, etc.

**Rationale**:

- **Less nesting**: Users work directly with `modules/`, not `src/modules/`
- **Clearer structure**: Top-level folders show application architecture immediately
- **No confusion**: "Source" is everything - what would NOT be in `src/`?
- **Better imports**: `../../modules/` vs `../../../src/modules/`

**When you might need `src/`**: Never for Studio applications. Quartermaster doesn't generate it.

---

### Why No `components/` Folder?

**Decision**: No generic `components/` folder. Everything is a module in `modules/`.

**Rationale**:

- **Modules ARE components**: Every module is a Pagewright component
- **LCA rule handles sharing**: Shared components live at their lowest common ancestor
- **No arbitrary distinction**: What makes something a "component" vs a "module"? Nothing.
- **Semantic organization**: Organize by feature/domain (ContactForm, CheckoutWizard), not by type

**Example**:

```tsx
// Everything is a module at appropriate nesting level
modules/
├── ContactPage/
│   ├── index.tsx
│   └── ContactForm/      # Component nested in page that uses it
│       └── index.tsx
└── SharedButton/          # At LCA if used by multiple pages
    └── index.tsx
```

**Pagewright provides comprehensive vocabulary**: If you need a button, card, form, etc., use Pagewright's semantic components. No custom generic components folder.

---

### Why `modules/` Instead of `pages/`?

**Decision**: Call the folder `modules/` not `pages/`.

**Rationale**:

- **Not all modules are pages**: Some are components rendered in other modules
- **Context determines rendering**: Module with `<Route>` = page. Without route = component.
- **Semantic accuracy**: They're composable modules, not just pages
- **Flexibility**: Same module can be a page in one context, a component in another

**Example**:

```tsx
// ContactForm as a page (has route)
modules/
└── ContactForm/
    └── index.tsx      # <Route path="/contact" page={<Self />} />

// ContactForm as a component (used in another module)
modules/
└── HomePage/
    ├── index.tsx
    └── ContactForm/
        └── index.tsx  # No route, just renders in HomePage
```

---

### Why `ledger/` Instead of `state/`?

**Decision**: Call it `ledger/` not `state/` or `custodian/`.

**Rationale**:

- **Semantic clarity**: "Ledger" evokes bookkeeping, accounting, state tracking
- **Avoids library names**: No "custodian" folder (implementation detail)
- **User-friendly**: "State" is too generic and technical
- **Clear purpose**: Stores state machine definitions, like a ledger tracks entries

---

### Why `connections/` Instead of `distributed/` or `agents/`?

**Decision**: Call it `connections/` not `distributed/`, `p2p/`, or `agent/`.

**Rationale**:

- **User-friendly**: "Connecting" to other devices/users/services is clear
- **Avoids technical jargon**: "Distributed," "P2P," "CRDT" are implementation details
- **No library names**: No "agent" folder (that's the library, not the purpose)
- **Broad scope**: Covers P2P, server connections, database, Solid pods, DIDs, etc.

---

### Why Everything Autogenerated in `.sitebender/`?

**Decision**: All build tooling, contracts, tests, certificates in `.sitebender/`.

**Rationale**:

- **Hidden by default**: Starts with `.` (hidden on Unix systems)
- **Users work with JSX**: Tooling/contracts are implementation details
- **Clear boundary**: User-authored vs autogenerated
- **Reduces clutter**: No `contracts/`, `tests/`, `certs/` folders at top level
- **Consistent convention**: Like `.git/`, `.vscode/`, `.github/`

**User-authored folders**: `modules/`, `auth/`, `ledger/`, `events/`, `connections/`, `assets/`

**Autogenerated folders**: `.sitebender/`

---

## What Goes Where

### "I want to add a new page"

**Answer**: Create a new module in `modules/` with a `<Route>`:

```tsx
// modules/ServicesPage/index.tsx
export default function ServicesPage() {
  return (
    <Route path="/services" page={<Self />}>
      <Heading>Our Services</Heading>
      <ServicesList />
    </Route>
  );
}
```

Then import it in `modules/index.tsx` and add to routes.

---

### "I want to add authentication"

**Answer**: Define auth config in `auth/config/`, create wrapper in `auth/Locked/`, use in modules.

See [Lock System Documentation](../../steward/docs/locks.md) for complete details.

---

### "I want multi-step checkout"

**Answer**: Define state machine in `ledger/CheckoutWizard/index.tsx`, import into `modules/index.tsx`.

---

### "I want real-time notifications"

**Answer**: Define event channel in `events/Notifications/index.tsx`, import into `modules/index.tsx`.

---

### "I want collaborative editing"

**Answer**: Define CRDT config in `connections/RealtimeCollab/index.tsx`, import into `modules/index.tsx`.

---

### "I want to add an image"

**Answer**: Place in `assets/images/`, reference in modules:

```tsx
<img src="/assets/images/logo.svg" alt="Logo" />
```

---

### "I want to configure the whole app"

**Answer**: Edit `modules/index.tsx` (the root `<Sitebender>` component).

---

### "I want to customize the build"

**Answer**: Edit `.sitebender/scripts/build.ts` (autogenerated, but editable if needed).

---

### "I want to add tests"

**Answer**: Tests are autogenerated in `.sitebender/tests/`. Auditor and Quarrier generate property-based tests and proofs.

For custom tests, co-locate with modules: `modules/ContactForm/index.test.ts`

---

## Examples of Typical Files

### Minimal Blog Structure

```
my-app/
├── .sitebender/
├── modules/
│   ├── index.tsx          # <Sitebender> config
│   ├── HomePage/
│   │   └── index.tsx      # Blog index
│   └── PostPage/
│       └── index.tsx      # Individual post (dynamic route)
├── assets/
│   └── images/
└── dist/
```

---

### E-Commerce Application

```
my-app/
├── .sitebender/
├── modules/
│   ├── index.tsx
│   ├── HomePage/
│   │   └── index.tsx
│   ├── ProductListPage/
│   │   ├── index.tsx
│   │   ├── ProductCard/
│   │   │   └── index.tsx
│   │   └── Filters/
│   │       └── index.tsx
│   ├── ProductDetailPage/
│   │   └── index.tsx
│   ├── CartPage/
│   │   └── index.tsx
│   └── CheckoutPage/
│       └── index.tsx
├── auth/
│   ├── Locked/
│   │   └── index.tsx
│   └── Keys/
│       └── index.ts
├── ledger/
│   └── CheckoutWizard/
│       └── index.tsx
├── events/
│   └── Analytics/
│       └── index.tsx
└── assets/
```

---

### Collaborative Dashboard

```
my-app/
├── .sitebender/
├── modules/
│   ├── index.tsx
│   ├── DashboardPage/
│   │   ├── index.tsx
│   │   ├── Chart/
│   │   │   └── index.tsx
│   │   └── DataTable/
│   │       └── index.tsx
│   └── SettingsPage/
│       └── index.tsx
├── auth/
│   ├── Locked/
│   │   └── index.tsx
│   └── Keys/
│       └── index.ts
├── connections/
│   └── RealtimeCollab/
│       └── index.tsx
└── events/
    └── Notifications/
        └── index.tsx
```

---

## Related Documentation

### Library Documentation

- [Pagewright](../../pagewright/README.md) - Semantic HTML components
- [Architect](../../architect/README.md) - Reactive calculations and validation
- [Custodian](../../custodian/README.md) - State management (ledger/ configurations)
- [Operator](../../operator/README.md) - Pub/sub events (events/ configurations)
- [Agent](../../agent/README.md) - Distributed/P2P (connections/ configurations)
- [Sentinel](../../sentinel/README.md) - Authentication (auth/ configurations)

### Quartermaster Documentation

- [Quartermaster README](../README.md) - Application generator overview
- [Lock System](../../steward/docs/locks.md) - Authentication and authorization patterns

### Studio Overview

- [Studio Overview](../../../docs/studio-overview.md) - Complete Studio philosophy and architecture
- [Syntax Status](../../../docs/syntax-status.md) - Canonical vs proposed syntax

---

## Frequently Asked Questions

### Can I add a `components/` folder?

**No.** Everything is a module in `modules/`. Use the LCA rule for shared components.

**Why?** There's no meaningful distinction between "component" and "module". Organize by feature/domain, not by type.

---

### Can I use `src/`?

**No.** Top-level folders are `modules/`, `auth/`, `ledger/`, etc. No `src/` wrapper.

**Why?** Less nesting, clearer structure, better imports.

---

### Where do I put utilities/helpers?

**Follow the LCA rule**: If a helper is used by one module, nest it inside that module. If used by multiple modules, place it at the lowest common ancestor.

**Example**:

```
modules/
├── ContactPage/
│   ├── index.tsx
│   └── helpers/           # Only ContactPage uses these
│       └── FormatPhone/
│           └── index.ts
└── helpers/               # Multiple modules use these (at LCA)
    └── FormatDate/
        └── index.ts
```

**All files still named `index.ts`** - names go on folders!

---

### Can I rename folders?

**Yes, but follow the rules**:

- Components/modules = PascalCase (HomePage, ContactForm)
- All files = `index.ts` or `index.tsx`
- Don't use library names (no `architect/`, `custodian/`)
- Use semantic names (purpose over implementation)

---

### What if I don't need a folder?

**Don't create it.** Minimal blog doesn't need `ledger/`, `events/`, or `connections/`. Only create what you use.

---

## Summary

**The Sitebender folder hierarchy follows three core principles**:

1. **ALL FILES ARE `index.ts` OR `index.tsx`** - Names go on folders, always
2. **Modules follow Lowest Common Ancestor (LCA)** - Shared code lives at branching point
3. **Routes promote modules to pages** - Context determines rendering

This creates a structure that is:

- **Portable** - Move a folder, move everything it needs
- **Decoupled** - Modules are independent, reusable
- **Clear** - Semantic organization by feature/domain
- **Maintainable** - Delete a module by deleting one folder

---

**Last Updated**: 2025-10-02  
**Status**: 🟢 CANONICAL - Production Ready
