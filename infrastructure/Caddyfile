{
  servers {
    protocols h1 h2 h3
  }
  # Disable automatic HSTS for local development
  default_sni localhost
}

# App Dev Server - Static files with HTTP/3
app.localhost {
  tls /certs/app.localhost.pem /certs/app.localhost-key.pem

  # Serve static files from quartermaster/dist
  root * /app/dist
  file_server browse

  # Enable compression
  encode gzip

  # Logs for debugging
  log {
    output stdout
    format console
  }
}

# OpenMetadata - Data Catalog UI
openmetadata.localhost {
  tls /certs/openmetadata.localhost.pem /certs/openmetadata.localhost-key.pem

  reverse_proxy openmetadata_server:8585

  encode gzip

  log {
    output stdout
    format console
  }
}

# Airflow - OpenMetadata Ingestion Pipeline
airflow.localhost {
  tls /certs/airflow.localhost.pem /certs/airflow.localhost-key.pem

  reverse_proxy openmetadata_ingestion:8080

  encode gzip

  log {
    output stdout
    format console
  }
}
